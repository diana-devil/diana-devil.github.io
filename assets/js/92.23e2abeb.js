(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{429:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("任何分布式架构都离不开服务的拆分，微服务也是一样。")]),s._v(" "),t("h2",{attrs:{id:"服务拆分原则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务拆分原则"}},[s._v("#")]),s._v(" 服务拆分原则")]),s._v(" "),t("p",[s._v("这里我总结了微服务拆分时的几个原则：")]),s._v(" "),t("ul",[t("li",[s._v("不同微服务，不要重复开发相同业务")]),s._v(" "),t("li",[s._v("微服务数据独立，不要访问其它微服务的数据库")]),s._v(" "),t("li",[s._v("微服务可以将自己的业务暴露为接口，供其它微服务调用")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713210800950.png",alt:"image-20210713210800950"}})]),s._v(" "),t("h2",{attrs:{id:"服务拆分示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务拆分示例"}},[s._v("#")]),s._v(" 服务拆分示例")]),s._v(" "),t("p",[s._v("以课前资料中的微服务cloud-demo为例，其结构如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713211009593.png",alt:"image-20210713211009593"}})]),s._v(" "),t("p",[s._v("cloud-demo：父工程，管理依赖")]),s._v(" "),t("ul",[t("li",[s._v("order-service：订单微服务，负责订单相关业务")]),s._v(" "),t("li",[s._v("user-service：用户微服务，负责用户相关业务")])]),s._v(" "),t("p",[s._v("要求：")]),s._v(" "),t("ul",[t("li",[s._v("订单微服务和用户微服务都必须有各自的数据库，相互独立")]),s._v(" "),t("li",[s._v("订单服务和用户服务都对外暴露Restful的接口")]),s._v(" "),t("li",[s._v("订单服务如果需要查询用户信息，只能调用用户服务的Restful接口，不能查询用户数据库")])]),s._v(" "),t("h3",{attrs:{id:"导入sql语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导入sql语句"}},[s._v("#")]),s._v(" 导入Sql语句")]),s._v(" "),t("p",[s._v("首先，将课前资料提供的"),t("code",[s._v("cloud-order.sql")]),s._v("和"),t("code",[s._v("cloud-user.sql")]),s._v("导入到mysql中：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713211417049.png",alt:"image-20210713211417049"}})]),s._v(" "),t("p",[s._v("cloud-user表中初始数据如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713211550169.png",alt:"image-20210713211550169"}})]),s._v(" "),t("p",[s._v("cloud-order表中初始数据如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713211657319.png",alt:"image-20210713211657319"}})]),s._v(" "),t("p",[s._v("cloud-order表中持有cloud-user表中的id字段。")]),s._v(" "),t("h3",{attrs:{id:"导入demo工程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导入demo工程"}},[s._v("#")]),s._v(" 导入demo工程")]),s._v(" "),t("p",[s._v("用IDEA导入课前资料提供的Demo：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713211814094.png",alt:"image-20210713211814094"}})]),s._v(" "),t("p",[s._v("项目结构如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713212656887.png",alt:"image-20210713212656887"}})]),s._v(" "),t("p",[s._v("导入后，会在IDEA右下角出现弹窗：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713212349272.png",alt:"image-20210713212349272"}})]),s._v(" "),t("p",[s._v("点击弹窗，然后按下图选择：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713212336185.png",alt:"image-20210713212336185"}})]),s._v(" "),t("p",[s._v("会出现这样的菜单：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713212513324.png",alt:"image-20210713212513324"}})]),s._v(" "),t("p",[s._v("配置下项目使用的JDK：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713220736408.png",alt:"image-20210713220736408"}})]),s._v(" "),t("h2",{attrs:{id:"实现远程调用案例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现远程调用案例"}},[s._v("#")]),s._v(" 实现远程调用案例")]),s._v(" "),t("p",[s._v("在order-service服务中，有一个根据id查询订单的接口：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713212749575.png",alt:"image-20210713212749575"}})]),s._v(" "),t("p",[s._v("根据id查询订单，返回值是Order对象，如图：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713212901725.png",alt:"image-20210713212901725"}})]),s._v(" "),t("p",[s._v("其中的user为null")]),s._v(" "),t("p",[s._v("在user-service中有一个根据id查询用户的接口：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713213146089.png",alt:"image-20210713213146089"}})]),s._v(" "),t("p",[s._v("查询的结果如图：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713213213075.png",alt:"image-20210713213213075"}})]),s._v(" "),t("h3",{attrs:{id:"案例需求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#案例需求"}},[s._v("#")]),s._v(" 案例需求：")]),s._v(" "),t("p",[s._v("修改order-service中的根据id查询订单业务，要求在查询订单的同时，根据订单中包含的userId查询出用户信息，一起返回。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713213312278.png",alt:"image-20210713213312278"}})]),s._v(" "),t("p",[s._v("因此，我们需要在order-service中 向user-service发起一个http的请求，调用http://localhost:8081/user/{userId}这个接口。")]),s._v(" "),t("p",[s._v("大概的步骤是这样的：")]),s._v(" "),t("ul",[t("li",[s._v("注册一个RestTemplate的实例到Spring容器")]),s._v(" "),t("li",[s._v("修改order-service服务中的OrderService类中的queryOrderById方法，根据Order对象中的userId查询User")]),s._v(" "),t("li",[s._v("将查询的User填充到Order对象，一起返回")])]),s._v(" "),t("h3",{attrs:{id:"注册resttemplate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注册resttemplate"}},[s._v("#")]),s._v(" "),t("strong",[s._v("注册RestTemplate")])]),s._v(" "),t("p",[s._v("首先，我们在order-service服务中的OrderApplication启动类中，注册RestTemplate实例：")]),s._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("cn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itcast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("order")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mybatis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("spring"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MapperScan")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("boot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringApplication")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("boot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("autoconfigure"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringBootApplication")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Bean")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("web"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RestTemplate")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@MapperScan")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn.itcast.order.mapper"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SpringBootApplication")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderApplication")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringApplication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderApplication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RestTemplate")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("restTemplate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RestTemplate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"实现远程调用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现远程调用"}},[s._v("#")]),s._v(" "),t("strong",[s._v("实现远程调用")])]),s._v(" "),t("p",[s._v("修改order-service服务中的cn.itcast.order.service包下的OrderService类中的queryOrderById方法：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713213959569.png",alt:"image-20210713213959569"}})]),s._v(" "),t("h2",{attrs:{id:"提供者与消费者"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#提供者与消费者"}},[s._v("#")]),s._v(" 提供者与消费者")]),s._v(" "),t("p",[s._v("在服务调用关系中，会有两个不同的角色：")]),s._v(" "),t("p",[t("strong",[s._v("服务提供者")]),s._v("：一次业务中，被其它微服务调用的服务。（提供接口给其它微服务）")]),s._v(" "),t("p",[t("strong",[s._v("服务消费者")]),s._v("：一次业务中，调用其它微服务的服务。（调用其它微服务提供的接口）")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713214404481.png",alt:"image-20210713214404481"}})]),s._v(" "),t("p",[s._v("但是，服务提供者与服务消费者的角色并不是绝对的，而是相对于业务而言。")]),s._v(" "),t("p",[s._v("如果服务A调用了服务B，而服务B又调用了服务C，服务B的角色是什么？")]),s._v(" "),t("ul",[t("li",[s._v("对于A调用B的业务而言：A是服务消费者，B是服务提供者")]),s._v(" "),t("li",[s._v("对于B调用C的业务而言：B是服务消费者，C是服务提供者")])]),s._v(" "),t("p",[s._v("因此，服务B既可以是服务提供者，也可以是服务消费者。")])])}),[],!1,null,null,null);t.default=e.exports}}]);