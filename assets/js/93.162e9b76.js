(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{431:function(a,t,s){"use strict";s.r(t);var e=s(2),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[a._v("假如我们的服务提供者user-service部署了多个实例，如图：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713214925388.png",alt:"image-20210713214925388"}})]),a._v(" "),t("p",[a._v("大家思考几个问题：")]),a._v(" "),t("ul",[t("li",[a._v("order-service在发起远程调用的时候，该如何得知user-service实例的ip地址和端口？")]),a._v(" "),t("li",[a._v("有多个user-service实例地址，order-service调用时该如何选择？")]),a._v(" "),t("li",[a._v("order-service如何得知某个user-service实例是否依然健康，是不是已经宕机？")])]),a._v(" "),t("h2",{attrs:{id:"eureka的结构和作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eureka的结构和作用"}},[a._v("#")]),a._v(" Eureka的结构和作用")]),a._v(" "),t("p",[a._v("这些问题都需要利用SpringCloud中的注册中心来解决，其中最广为人知的注册中心就是Eureka，其结构如下：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713220104956.png",alt:"image-20210713220104956"}})]),a._v(" "),t("p",[a._v("回答之前的各个问题。")]),a._v(" "),t("p",[a._v("问题1：order-service如何得知user-service实例地址？")]),a._v(" "),t("p",[a._v("获取地址信息的流程如下：")]),a._v(" "),t("ul",[t("li",[a._v("user-service服务实例启动后，将自己的信息注册到eureka-server（Eureka服务端）。这个叫服务注册")]),a._v(" "),t("li",[a._v("eureka-server保存服务名称到服务实例地址列表的映射关系")]),a._v(" "),t("li",[a._v("order-service根据服务名称，拉取实例地址列表。这个叫服务发现或服务拉取")])]),a._v(" "),t("p",[a._v("问题2：order-service如何从多个user-service实例中选择具体的实例？")]),a._v(" "),t("ul",[t("li",[a._v("order-service从实例列表中利用负载均衡算法选中一个实例地址")]),a._v(" "),t("li",[a._v("向该实例地址发起远程调用")])]),a._v(" "),t("p",[a._v("问题3：order-service如何得知某个user-service实例是否依然健康，是不是已经宕机？")]),a._v(" "),t("ul",[t("li",[a._v("user-service会每隔一段时间（默认30秒）向eureka-server发起请求，报告自己状态，称为心跳")]),a._v(" "),t("li",[a._v("当超过一定时间没有发送心跳时，eureka-server会认为微服务实例故障，将该实例从服务列表中剔除")]),a._v(" "),t("li",[a._v("order-service拉取服务时，就能将故障实例排除了")])]),a._v(" "),t("blockquote",[t("p",[a._v("注意：一个微服务，既可以是服务提供者，又可以是服务消费者，因此eureka将服务注册、服务发现等功能统一封装到了eureka-client端")])]),a._v(" "),t("p",[a._v("因此，接下来我们动手实践的步骤包括：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713220509769.png",alt:"image-20210713220509769"}})]),a._v(" "),t("h2",{attrs:{id:"搭建eureka-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建eureka-server"}},[a._v("#")]),a._v(" 搭建eureka-server")]),a._v(" "),t("p",[a._v("首先大家注册中心服务端：eureka-server，这必须是一个独立的微服务")]),a._v(" "),t("h3",{attrs:{id:"创建eureka-server服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建eureka-server服务"}},[a._v("#")]),a._v(" 创建eureka-server服务")]),a._v(" "),t("p",[a._v("在cloud-demo父工程下，创建一个子模块：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713220605881.png",alt:"image-20210713220605881"}})]),a._v(" "),t("p",[a._v("填写模块信息：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713220857396.png",alt:"image-20210713220857396"}})]),a._v(" "),t("p",[a._v("然后填写服务信息：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713221339022.png",alt:"image-20210713221339022"}})]),a._v(" "),t("h3",{attrs:{id:"引入eureka依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#引入eureka依赖"}},[a._v("#")]),a._v(" 引入eureka依赖")]),a._v(" "),t("p",[a._v("引入SpringCloud为eureka提供的starter依赖：")]),a._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.springframework.cloud"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-netflix-eureka-server"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),t("h3",{attrs:{id:"编写启动类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写启动类"}},[a._v("#")]),a._v(" 编写启动类")]),a._v(" "),t("p",[a._v("给eureka-server服务编写一个启动类，一定要添加一个@EnableEurekaServer注解，开启eureka的注册中心功能：")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("package")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("cn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("itcast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("eureka")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("springframework"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("boot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SpringApplication")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("springframework"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("boot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("autoconfigure"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SpringBootApplication")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("springframework"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cloud"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("netflix"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("eureka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("EnableEurekaServer")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@SpringBootApplication")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@EnableEurekaServer")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("EurekaApplication")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SpringApplication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("EurekaApplication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h3",{attrs:{id:"编写配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写配置文件"}},[a._v("#")]),a._v(" 编写配置文件")]),a._v(" "),t("p",[a._v("编写一个application.yml文件，内容如下：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10086")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" eureka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("server\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("eureka")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("client")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("service-url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("defaultZone")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//127.0.0.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("10086/eureka\n")])])]),t("h3",{attrs:{id:"启动服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动服务"}},[a._v("#")]),a._v(" 启动服务")]),a._v(" "),t("p",[a._v("启动微服务，然后在浏览器访问：http://127.0.0.1:10086")]),a._v(" "),t("p",[a._v("看到下面结果应该是成功了：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713222157190.png",alt:"image-20210713222157190"}})]),a._v(" "),t("h2",{attrs:{id:"服务注册"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务注册"}},[a._v("#")]),a._v(" 服务注册")]),a._v(" "),t("p",[a._v("下面，我们将user-service注册到eureka-server中去。")]),a._v(" "),t("h3",{attrs:{id:"_1-引入依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-引入依赖"}},[a._v("#")]),a._v(" 1）引入依赖")]),a._v(" "),t("p",[a._v("在user-service的pom文件中，引入下面的eureka-client依赖：")]),a._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.springframework.cloud"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-netflix-eureka-client"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),t("h3",{attrs:{id:"_2-配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件"}},[a._v("#")]),a._v(" 2）配置文件")]),a._v(" "),t("p",[a._v("在user-service中，修改application.yml文件，添加服务名称、eureka地址：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" userservice\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("eureka")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("client")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("service-url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("defaultZone")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//127.0.0.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("10086/eureka\n")])])]),t("h3",{attrs:{id:"_3-启动多个user-service实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动多个user-service实例"}},[a._v("#")]),a._v(" 3）启动多个user-service实例")]),a._v(" "),t("p",[a._v("为了演示一个服务有多个实例的场景，我们添加一个SpringBoot的启动配置，再启动一个user-service。")]),a._v(" "),t("p",[a._v("首先，复制原来的user-service启动配置：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713222656562.png",alt:"image-20210713222656562"}})]),a._v(" "),t("p",[t("strong",[a._v("补充")])]),a._v(" "),t("blockquote",[t("p",[a._v("新版idea，下方这个页面不完全一样，注意要写在  "),t("strong",[a._v("VM options")]),a._v("这个选项栏里")]),a._v(" "),t("p",[a._v("这里重新配置一个端口，会覆盖掉yml文件中的端口定义，避免端口冲突。")])]),a._v(" "),t("p",[a._v("然后，在弹出的窗口中，填写信息：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713222757702.png",alt:"image-20210713222757702"}})]),a._v(" "),t("p",[a._v("现在，SpringBoot窗口会出现两个user-service启动配置：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713222841951.png",alt:"image-20210713222841951"}})]),a._v(" "),t("p",[a._v("不过，第一个是8081端口，第二个是8082端口。")]),a._v(" "),t("p",[a._v("启动两个user-service实例：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713223041491.png",alt:"image-20210713223041491"}})]),a._v(" "),t("p",[a._v("查看eureka-server管理页面：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713223150650.png",alt:"image-20210713223150650"}})]),a._v(" "),t("h2",{attrs:{id:"服务发现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务发现"}},[a._v("#")]),a._v(" 服务发现")]),a._v(" "),t("p",[a._v("下面，我们将order-service的逻辑修改：向eureka-server拉取user-service的信息，实现服务发现。")]),a._v(" "),t("h3",{attrs:{id:"_1-引入依赖-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-引入依赖-2"}},[a._v("#")]),a._v(" 1）引入依赖")]),a._v(" "),t("p",[a._v("之前说过，服务发现、服务注册统一都封装在eureka-client依赖，因此这一步与服务注册时一致。")]),a._v(" "),t("p",[a._v("在order-service的pom文件中，引入下面的eureka-client依赖：")]),a._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.springframework.cloud"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-netflix-eureka-client"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),t("h3",{attrs:{id:"_2-配置文件-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件-2"}},[a._v("#")]),a._v(" 2）配置文件")]),a._v(" "),t("p",[a._v("服务发现也需要知道eureka地址，因此第二步与服务注册一致，都是配置eureka信息：")]),a._v(" "),t("p",[a._v("在order-service中，修改application.yml文件，添加服务名称、eureka地址：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" orderservice\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("eureka")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("client")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("service-url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("defaultZone")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//127.0.0.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("10086/eureka\n")])])]),t("h3",{attrs:{id:"_3-服务拉取和负载均衡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-服务拉取和负载均衡"}},[a._v("#")]),a._v(" 3）服务拉取和负载均衡")]),a._v(" "),t("p",[a._v("最后，我们要去eureka-server中拉取user-service服务的实例列表，并且实现负载均衡。")]),a._v(" "),t("p",[a._v("不过这些动作不用我们去做，只需要添加一些注解即可。")]),a._v(" "),t("p",[a._v("在order-service的OrderApplication中，给RestTemplate这个Bean添加一个@LoadBalanced注解：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713224049419.png",alt:"image-20210713224049419"}})]),a._v(" "),t("p",[a._v("修改order-service服务中的cn.itcast.order.service包下的OrderService类中的queryOrderById方法。修改访问的url路径，用服务名代替ip、端口：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/image-20210713224245731.png",alt:"image-20210713224245731"}})]),a._v(" "),t("p",[a._v("spring会自动帮助我们从eureka-server端，根据userservice这个服务名称，获取实例列表，而后完成负载均衡。")]),a._v(" "),t("h2",{attrs:{id:"eureka注册中心-总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eureka注册中心-总结"}},[a._v("#")]),a._v(" "),t("strong",[a._v("Eureka注册中心 总结")])]),a._v(" "),t("h3",{attrs:{id:"_1-搭建eurekaserver"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-搭建eurekaserver"}},[a._v("#")]),a._v(" 1.搭建EurekaServer")]),a._v(" "),t("ul",[t("li",[a._v("引入"),t("code",[a._v("eureka-server")]),a._v("依赖")]),a._v(" "),t("li",[a._v("添加"),t("code",[a._v("@EnableEurekaServer")]),a._v("注解开关")]),a._v(" "),t("li",[a._v("在"),t("code",[a._v("application.yml")]),a._v("中配置"),t("strong",[a._v("服务名称")]),a._v("，"),t("strong",[a._v("eureka服务地址")])])]),a._v(" "),t("h3",{attrs:{id:"_2-服务注册"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务注册"}},[a._v("#")]),a._v(" 2.服务注册")]),a._v(" "),t("ul",[t("li",[a._v("引入"),t("code",[a._v("eureka-client")]),a._v("依赖")]),a._v(" "),t("li",[a._v("在"),t("code",[a._v("application.yml")]),a._v("中配置"),t("strong",[a._v("服务名称")]),a._v("，"),t("strong",[a._v("eureka服务地址")])])]),a._v(" "),t("h3",{attrs:{id:"_3-服务发现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-服务发现"}},[a._v("#")]),a._v(" 3.服务发现")]),a._v(" "),t("ul",[t("li",[a._v("引入"),t("code",[a._v("eureka-client")]),a._v("依赖")]),a._v(" "),t("li",[a._v("在"),t("code",[a._v("application.yml")]),a._v("中配置"),t("strong",[a._v("服务名称")]),a._v("，"),t("strong",[a._v("eureka服务地址")])]),a._v(" "),t("li",[a._v("给"),t("code",[a._v("RestTemplate")]),a._v("添加"),t("code",[a._v("@LoadBalanced")]),a._v("注解，实现负载均衡")]),a._v(" "),t("li",[a._v("用服务者的服务名称（来代替网站的硬编码）实现远程调用")])])])}),[],!1,null,null,null);t.default=r.exports}}]);