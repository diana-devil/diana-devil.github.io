(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{387:function(s,t,e){"use strict";e.r(t);var a=e(2),n=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"集群结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群结构"}},[s._v("#")]),s._v(" 集群结构")]),s._v(" "),t("p",[s._v("这里我们搭建一个三节点形成的Sentinel集群，来监管之前的Redis主从集群。如图：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210701215227018.png",alt:"image-20210701215227018"}})]),s._v(" "),t("p",[s._v("三个sentinel实例信息如下：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("节点")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("IP")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("PORT")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("s1")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("27001")])]),s._v(" "),t("tr",[t("td",[s._v("s2")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("27002")])]),s._v(" "),t("tr",[t("td",[s._v("s3")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("27003")])])])]),s._v(" "),t("h2",{attrs:{id:"准备实例和配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备实例和配置"}},[s._v("#")]),s._v(" 准备实例和配置")]),s._v(" "),t("p",[s._v("要在同一台虚拟机开启3个实例，必须准备三份不同的配置文件和目录，配置文件所在目录也就是工作目录。")]),s._v(" "),t("p",[s._v("我们创建三个文件夹，名字分别叫s1、s2、s3：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入/tmp目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /tmp\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" s1 s2 s3\n")])])]),t("p",[s._v("如图：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210701215534714.png",alt:"image-20210701215534714"}})]),s._v(" "),t("p",[s._v("然后我们在s1目录创建一个sentinel.conf文件，添加下面的内容：")]),s._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[s._v('port 27001\nsentinel announce-ip 192.168.150.101\nsentinel monitor mymaster 192.168.150.101 7001 2\nsentinel down-after-milliseconds mymaster 5000\nsentinel failover-timeout mymaster 60000\ndir "/tmp/s1"\n')])])]),t("p",[s._v("解读：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("port 27001")]),s._v("：是当前sentinel实例的端口")]),s._v(" "),t("li",[t("code",[s._v("sentinel monitor mymaster 192.168.150.101 7001 2")]),s._v("：指定主节点信息\n"),t("ul",[t("li",[t("code",[s._v("mymaster")]),s._v("：主节点名称，自定义，任意写")]),s._v(" "),t("li",[t("code",[s._v("192.168.150.101 7001")]),s._v("：主节点的ip和端口")]),s._v(" "),t("li",[t("code",[s._v("2")]),s._v("：选举master时的quorum值")])])])]),s._v(" "),t("p",[s._v("然后将s1/sentinel.conf文件拷贝到s2、s3两个目录中（在/tmp目录执行下列命令）：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方式一：逐个拷贝")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" s1/sentinel.conf s2\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" s1/sentinel.conf s3\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方式二：管道组合命令，一键拷贝")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" s2 s3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" s1/sentinel.conf\n")])])]),t("p",[s._v("修改s2、s3两个文件夹内的配置文件，将端口分别修改为27002、27003：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/27001/27002/g'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/s1/s2/g'")]),s._v(" s2/sentinel.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/27001/27003/g'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/s1/s3/g'")]),s._v(" s3/sentinel.conf\n")])])]),t("h2",{attrs:{id:"启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),t("p",[s._v("为了方便查看日志，我们打开3个ssh窗口，分别启动3个redis实例，启动命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第1个")]),s._v("\nredis-sentinel s1/sentinel.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第2个")]),s._v("\nredis-sentinel s2/sentinel.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第3个")]),s._v("\nredis-sentinel s3/sentinel.conf\n")])])]),t("p",[s._v("启动后：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210701220714104.png",alt:"image-20210701220714104"}})]),s._v(" "),t("h2",{attrs:{id:"测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),t("p",[s._v("尝试让master节点7001宕机，查看sentinel日志：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210701222857997.png",alt:"image-20210701222857997"}})]),s._v(" "),t("p",[s._v("查看7003的日志：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210701223025709.png",alt:"image-20210701223025709"}})]),s._v(" "),t("p",[s._v("查看7002的日志：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210701223131264.png",alt:"image-20210701223131264"}})])])}),[],!1,null,null,null);t.default=n.exports}}]);