(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{396:function(s,a,t){"use strict";t.r(a);var e=t(2),v=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("Redis分片集群-"),a("strong",[a("RouterLink",{attrs:{to:"/pages/18dc29/"}},[s._v("类似于分布式搜索引擎es的集群")])],1)]),s._v(" "),a("ul",[a("li",[s._v("分片存储")]),s._v(" "),a("li",[s._v("客户端请求可以访问集群任意节点，最终都会被转发到正确节点")]),s._v(" "),a("li",[s._v("散列插槽\n"),a("ul",[a("li",[s._v("数据跟插槽绑定")]),s._v(" "),a("li",[s._v("客户端请求可以访问集群任意节点，最终都会被转发到正确节点——请求路由\n"),a("ul",[a("li",[s._v("先计算插槽，在根据插槽访问对应结点")])])])])]),s._v(" "),a("li",[s._v("集群伸缩")])]),s._v(" "),a("h2",{attrs:{id:"搭建分片集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搭建分片集群"}},[s._v("#")]),s._v(" 搭建分片集群")]),s._v(" "),a("p",[s._v("**主从和哨兵可以解决高可用、高并发读的问题。**但是依然有两个问题没有解决：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("海量数据存储问题")]),s._v(" "),a("ul",[a("li",[s._v("单点redis，内存小")])])]),s._v(" "),a("li",[a("p",[s._v("高并发写的问题")]),s._v(" "),a("ul",[a("li",[s._v("读的slave虽然多，但是负责写的master只有一个。")])])])]),s._v(" "),a("p",[s._v("使用分片集群可以解决上述问题，如图:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725155747294.png",alt:"image-20210725155747294"}})]),s._v(" "),a("p",[s._v("分片集群特征：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("集群中有多个master，每个master保存不同数据")])]),s._v(" "),a("li",[a("p",[s._v("每个master都可以有多个slave节点")])]),s._v(" "),a("li",[a("p",[s._v("master之间通过ping监测彼此健康状态")])]),s._v(" "),a("li",[a("p",[s._v("客户端请求可以访问集群任意节点，最终都会被转发到正确节点")])])]),s._v(" "),a("p",[a("RouterLink",{attrs:{to:"/pages/fdb88d/"}},[s._v("具体搭建流程")])],1),s._v(" "),a("h2",{attrs:{id:"散列插槽"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#散列插槽"}},[s._v("#")]),s._v(" 散列插槽")]),s._v(" "),a("h3",{attrs:{id:"插槽原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插槽原理"}},[s._v("#")]),s._v(" 插槽原理")]),s._v(" "),a("p",[s._v("Redis会把每一个master节点映射到0~16383共16384个插槽（hash slot）上，查看集群信息时就能看到：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725155820320.png",alt:"image-20210725155820320"}})]),s._v(" "),a("p",[s._v("数据key不是与节点绑定，而是与插槽绑定。redis会根据key的有效部分计算插槽值，分两种情况：")]),s._v(" "),a("ul",[a("li",[s._v('key中包含"{}"，且“{}”中至少包含1个字符，“{}”中的部分是有效部分')]),s._v(" "),a("li",[s._v("key中不包含“{}”，整个key都是有效部分")])]),s._v(" "),a("p",[s._v("例如：key是num，那么就根据num计算，如果是{itcast}num，则根据itcast计算。计算方式是利用CRC16算法得到一个hash值，然后对16384取余，得到的结果就是slot值。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725155850200.png",alt:"image-20210725155850200"}})]),s._v(" "),a("p",[s._v("如图，在7001这个节点执行set a 1时，对a做hash运算，对16384取余，得到的结果是15495，因此要存储到103节点。")]),s._v(" "),a("p",[s._v("到了7003后，执行"),a("code",[s._v("get num")]),s._v("时，对num做hash运算，对16384取余，得到的结果是2765，因此需要切换到7001节点")]),s._v(" "),a("h3",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),a("p",[s._v("Redis如何判断某个key应该在哪个实例？")]),s._v(" "),a("ul",[a("li",[s._v("将16384个插槽分配到不同的实例")]),s._v(" "),a("li",[s._v("根据key的有效部分计算哈希值，对16384取余")]),s._v(" "),a("li",[s._v("余数作为插槽，寻找插槽所在实例即可")])]),s._v(" "),a("p",[a("strong",[s._v("如何将同一类数据固定的保存在同一个Redis实例？")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("这一类数据使用相同的有效部分，例如key都以{typeId}为前缀")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/%E6%95%A3%E5%88%97%E6%8F%92%E6%A7%BD.png",alt:""}})])])]),s._v(" "),a("h2",{attrs:{id:"集群伸缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集群伸缩"}},[s._v("#")]),s._v(" 集群伸缩")]),s._v(" "),a("p",[s._v("redis-cli --cluster提供了很多操作集群的命令，可以通过下面方式查看：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725160138290.png",alt:"image-20210725160138290"}})]),s._v(" "),a("p",[s._v("比如，添加节点的命令：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725160448139.png",alt:"image-20210725160448139"}})]),s._v(" "),a("ul",[a("li",[s._v("不加蓝色部分，默认是一个master")]),s._v(" "),a("li",[s._v("加了就指定它为slave结点，并指定一个master结点")])]),s._v(" "),a("h3",{attrs:{id:"需求分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需求分析"}},[s._v("#")]),s._v(" 需求分析")]),s._v(" "),a("p",[s._v("需求：向集群中添加一个新的master节点，并向其中存储 num = 10")]),s._v(" "),a("ul",[a("li",[s._v("启动一个新的redis实例，端口为7004")]),s._v(" "),a("li",[s._v("添加7004到之前的集群，并作为一个master节点")]),s._v(" "),a("li",[s._v("给7004节点分配插槽，使得num这个key可以存储到7004实例")])]),s._v(" "),a("p",[s._v("这里需要两个新的功能：")]),s._v(" "),a("ul",[a("li",[s._v("添加一个节点到集群中")]),s._v(" "),a("li",[s._v("将部分插槽分配到新插槽")])]),s._v(" "),a("h3",{attrs:{id:"创建新的redis实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建新的redis实例"}},[s._v("#")]),s._v(" 创建新的redis实例")]),s._v(" "),a("p",[s._v("创建一个文件夹：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7004")]),s._v("\n")])])]),a("p",[s._v("拷贝配置文件：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" redis.conf ./7004\n")])])]),a("p",[s._v("修改配置文件：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" /s/6379/7004/g "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7004")]),s._v("/redis.conf\n")])])]),a("p",[s._v("启动")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("redis-server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7004")]),s._v("/redis.conf\n")])])]),a("h3",{attrs:{id:"添加新节点到redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加新节点到redis"}},[s._v("#")]),s._v(" 添加新节点到redis")]),s._v(" "),a("p",[s._v("添加节点的语法如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725160448139.png",alt:"image-20210725160448139"}})]),s._v(" "),a("p",[s._v("执行命令：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("redis-cli --cluster")]),s._v(" 新版本集群命令  大于5.0")]),s._v(" "),a("li",[a("code",[s._v("./redis-trib.rb")]),s._v(" 旧版本集群命令")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#旧版本")]),s._v("\n./redis-trib.rb add-node "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".159.100:7004 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".159.100:7001\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新版本")]),s._v("\nredis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" add-node  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:7004 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:7001\n")])])]),a("p",[s._v("通过命令查看集群状态：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" cluster nodes\n")])])]),a("p",[s._v("如图，7004加入了集群，并且默认是一个master节点：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725161007099.png",alt:"image-20210725161007099"}})]),s._v(" "),a("p",[s._v("但是，可以看到7004节点的插槽数量为0，因此没有任何数据可以存储到7004上")]),s._v(" "),a("h3",{attrs:{id:"转移插槽"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#转移插槽"}},[s._v("#")]),s._v(" 转移插槽")]),s._v(" "),a("p",[s._v("我们要将num存储到7004节点，因此需要先看看num的插槽是多少：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725161241793.png",alt:"image-20210725161241793"}})]),s._v(" "),a("p",[s._v("如上图所示，num的插槽为2765.")]),s._v(" "),a("p",[s._v("我们可以将0~3000的插槽从7001转移到7004，命令格式如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725161401925.png",alt:"image-20210725161401925"}})]),s._v(" "),a("p",[s._v("具体命令如下：")]),s._v(" "),a("p",[s._v("建立连接：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725161506241.png",alt:"image-20210725161506241"}})]),s._v(" "),a("p",[s._v("得到下面的反馈：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725161540841.png",alt:"image-20210725161540841"}})]),s._v(" "),a("p",[s._v("询问要移动多少个插槽，我们计划是3000个：")]),s._v(" "),a("p",[s._v("新的问题来了：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725161637152.png",alt:"image-20210725161637152"}})]),s._v(" "),a("p",[s._v("那个node来接收这些插槽？？")]),s._v(" "),a("p",[s._v("显然是7004，那么7004节点的id是多少呢？")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725161731738.png",alt:"image-20210725161731738"}})]),s._v(" "),a("p",[s._v("复制这个id，然后拷贝到刚才的控制台后：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725161817642.png",alt:"image-20210725161817642"}})]),s._v(" "),a("p",[s._v("这里询问，你的插槽是从哪里移动过来的？")]),s._v(" "),a("ul",[a("li",[s._v("all：代表全部，也就是三个节点各转移一部分")]),s._v(" "),a("li",[s._v("具体的id：目标节点的id")]),s._v(" "),a("li",[s._v("done：没有了")])]),s._v(" "),a("p",[s._v("这里我们要从7001获取，因此填写7001的id：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725162030478.png",alt:"image-20210725162030478"}})]),s._v(" "),a("p",[s._v("填完后，点击done，这样插槽转移就准备好了：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725162101228.png",alt:"image-20210725162101228"}})]),s._v(" "),a("p",[s._v("确认要转移吗？输入yes：")]),s._v(" "),a("p",[s._v("然后，通过命令查看结果：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725162145497.png",alt:"image-20210725162145497"}})]),s._v(" "),a("p",[s._v("可以看到：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725162224058.png",alt:"image-20210725162224058"}})]),s._v(" "),a("p",[s._v("目的达成。")]),s._v(" "),a("h3",{attrs:{id:"删除结点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除结点"}},[s._v("#")]),s._v(" 删除结点")]),s._v(" "),a("p",[s._v("需求： 删除7004实例")]),s._v(" "),a("p",[a("strong",[s._v("不能直接将带槽的结点删除，必须先转移到其他结点上")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将插槽转移到其他结点-7001 (reshard)")]),s._v("\nredis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v("  reshard "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".159.100:7004\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除结点-7004 (del-node)")]),s._v("\nredis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" del-node "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".159.100:7004 d4c35f052518c45d9a06a90e08680dade4043752\n")])])]),a("h2",{attrs:{id:"故障转移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#故障转移"}},[s._v("#")]),s._v(" 故障转移")]),s._v(" "),a("p",[s._v("集群初识状态是这样的：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210727161152065.png",alt:"image-20210727161152065"}})]),s._v(" "),a("p",[s._v("其中7001、7002、7003都是master，我们计划让7002宕机。")]),s._v(" "),a("h3",{attrs:{id:"自动故障转移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动故障转移"}},[s._v("#")]),s._v(" 自动故障转移")]),s._v(" "),a("p",[s._v("当集群中有一个master宕机会发生什么呢？")]),s._v(" "),a("p",[a("strong",[s._v("自动实现主从切换")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("观测 结点状态")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" cluster nodes\n")])])])])]),s._v(" "),a("p",[s._v("直接停止一个redis实例，例如7002：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n")])])]),a("p",[s._v("1）首先是该实例与其它实例失去连接")]),s._v(" "),a("p",[s._v("2）然后是疑似宕机：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725162319490.png",alt:"image-20210725162319490"}})]),s._v(" "),a("p",[s._v("3）最后是确定下线，自动提升一个slave为新的master：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725162408979.png",alt:"image-20210725162408979"}})]),s._v(" "),a("p",[s._v("4）当7002再次启动，就会变为一个slave节点了：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210727160803386.png",alt:"image-20210727160803386"}})]),s._v(" "),a("h3",{attrs:{id:"手动故障转移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手动故障转移"}},[s._v("#")]),s._v(" 手动故障转移")]),s._v(" "),a("p",[s._v("利用cluster failover命令可以手动让集群中的某个master宕机，切换到执行cluster failover命令的这个slave节点，实现无感知的数据迁移。其流程如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210725162441407.png",alt:"image-20210725162441407"}})]),s._v(" "),a("p",[s._v("这种failover命令可以指定三种模式：")]),s._v(" "),a("ul",[a("li",[s._v("缺省：默认的流程，如图1~6歩")]),s._v(" "),a("li",[s._v("force：省略了对offset的一致性校验")]),s._v(" "),a("li",[s._v("takeover：直接执行第5歩，忽略数据一致性、忽略master状态和其它master的意见")])]),s._v(" "),a("p",[a("strong",[s._v("案例需求")]),s._v("：在7002这个slave节点执行手动故障转移，重新夺回master地位")]),s._v(" "),a("p",[s._v("步骤如下：")]),s._v(" "),a("p",[s._v("1）利用redis-cli连接7002这个节点")]),s._v(" "),a("p",[s._v("2）执行"),a("code",[s._v("cluster failover")]),s._v("命令")]),s._v(" "),a("p",[s._v("如图：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210727160037766.png",alt:"image-20210727160037766"}})]),s._v(" "),a("p",[s._v("效果：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/image-20210727161152065.png",alt:"image-20210727161152065"}})]),s._v(" "),a("h2",{attrs:{id:"redistemplate访问分片集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redistemplate访问分片集群"}},[s._v("#")]),s._v(" RedisTemplate访问分片集群")]),s._v(" "),a("p",[s._v("RedisTemplate底层同样基于lettuce实现了分片集群的支持，而使用的步骤与哨兵模式基本一致：")]),s._v(" "),a("p",[s._v("1）引入redis的starter依赖")]),s._v(" "),a("p",[s._v("2）配置分片集群地址")]),s._v(" "),a("p",[s._v("3）配置读写分离")]),s._v(" "),a("p",[s._v("与哨兵模式相比，其中只有分片集群的配置方式略有差异，如下：")]),s._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 192.168.150.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 192.168.150.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 192.168.150.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 192.168.150.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8001")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 192.168.150.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8002")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 192.168.150.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8003")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=v.exports}}]);