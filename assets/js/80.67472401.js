(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{420:function(t,s,a){"use strict";a.r(s);var n=a(2),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"倒排索引"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#倒排索引"}},[t._v("#")]),t._v(" 倒排索引")]),t._v(" "),s("p",[t._v("倒排索引的概念是基于MySQL这样的正向索引而言的。")]),t._v(" "),s("h3",{attrs:{id:"正向索引"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#正向索引"}},[t._v("#")]),t._v(" 正向索引")]),t._v(" "),s("p",[t._v("那么什么是正向索引呢？例如给下表（tb_goods）中的id创建索引：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ES/image-20210720195531539.png",alt:"image-20210720195531539"}})]),t._v(" "),s("p",[t._v("如果是根据id查询，那么直接走索引，查询速度非常快。")]),t._v(" "),s("p",[t._v("但如果是基于title做模糊查询，只能是逐行扫描数据，流程如下：")]),t._v(" "),s("p",[t._v("1）用户搜索数据，条件是title符合"),s("code",[t._v('"%手机%"')])]),t._v(" "),s("p",[t._v("2）逐行获取数据，比如id为1的数据")]),t._v(" "),s("p",[t._v("3）判断数据中的title是否符合用户搜索条件")]),t._v(" "),s("p",[t._v("4）如果符合则放入结果集，不符合则丢弃。回到步骤1")]),t._v(" "),s("p",[t._v("逐行扫描，也就是全表扫描，随着数据量增加，其查询效率也会越来越低。当数据量达到数百万时，就是一场灾难。")]),t._v(" "),s("h3",{attrs:{id:"倒排索引-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#倒排索引-2"}},[t._v("#")]),t._v(" "),s("strong",[t._v("倒排索引")])]),t._v(" "),s("p",[t._v("倒排索引中有两个非常重要的概念：")]),t._v(" "),s("ul",[s("li",[t._v("文档（"),s("code",[t._v("Document")]),t._v("）：用来搜索的数据，其中的每一条数据就是一个文档。例如一个网页、一个商品信息")]),t._v(" "),s("li",[t._v("词条（"),s("code",[t._v("Term")]),t._v("）：对文档数据或用户搜索数据，利用某种算法分词，得到的具备含义的词语就是词条。例如：我是中国人，就可以分为：我、是、中国人、中国、国人这样的几个词条")])]),t._v(" "),s("p",[s("strong",[t._v("创建倒排索引")]),t._v("是对正向索引的一种特殊处理，流程如下：")]),t._v(" "),s("ul",[s("li",[t._v("将每一个文档的数据利用算法分词，得到一个个词条")]),t._v(" "),s("li",[t._v("创建表，每行数据包括词条、词条所在文档id、位置等信息")]),t._v(" "),s("li",[t._v("因为词条唯一性，可以给词条创建索引，例如hash表结构索引")])]),t._v(" "),s("p",[t._v("如图：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ES/image-20210720200457207.png",alt:"image-20210720200457207"}})]),t._v(" "),s("p",[t._v("倒排索引的"),s("strong",[t._v("搜索流程")]),t._v('如下（以搜索"华为手机"为例）：')]),t._v(" "),s("p",[t._v("1）用户输入条件"),s("code",[t._v('"华为手机"')]),t._v("进行搜索。")]),t._v(" "),s("p",[t._v("2）对用户输入内容"),s("strong",[t._v("分词")]),t._v("，得到词条："),s("code",[t._v("华为")]),t._v("、"),s("code",[t._v("手机")]),t._v("。")]),t._v(" "),s("p",[t._v("3）拿着词条在倒排索引中查找，可以得到包含词条的文档id：1、2、3。")]),t._v(" "),s("p",[t._v("4）拿着文档id到正向索引中查找具体文档。")]),t._v(" "),s("p",[t._v("如图：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ES/image-20210720201115192.png",alt:"image-20210720201115192"}})]),t._v(" "),s("p",[t._v("虽然要先查询倒排索引，再查询倒排索引，但是无论是词条、还是文档id都建立了索引，查询速度非常快！无需全表扫描。")]),t._v(" "),s("h3",{attrs:{id:"正向和倒排"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#正向和倒排"}},[t._v("#")]),t._v(" 正向和倒排")]),t._v(" "),s("p",[t._v("那么为什么一个叫做正向索引，一个叫做倒排索引呢？")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("正向索引")]),t._v("是最传统的，根据id索引的方式。但根据词条查询时，必须先逐条获取每个文档，然后判断文档中是否包含所需要的词条，是"),s("strong",[t._v("根据文档找词条的过程")]),t._v("。")])]),t._v(" "),s("li",[s("p",[t._v("而"),s("strong",[t._v("倒排索引")]),t._v("则相反，是先找到用户要搜索的词条，根据词条得到保护词条的文档的id，然后根据id获取文档。是"),s("strong",[t._v("根据词条找文档的过程")]),t._v("。")])])]),t._v(" "),s("p",[t._v("是不是恰好反过来了？")]),t._v(" "),s("p",[t._v("那么两者方式的优缺点是什么呢？")]),t._v(" "),s("p",[s("strong",[t._v("正向索引")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("优点：\n"),s("ul",[s("li",[t._v("可以给多个字段创建索引")]),t._v(" "),s("li",[t._v("根据索引字段搜索、排序速度非常快")])])]),t._v(" "),s("li",[t._v("缺点：\n"),s("ul",[s("li",[s("strong",[t._v("根据非索引字段，或者索引字段中的部分词条查找时，只能全表扫描。")])])])])]),t._v(" "),s("p",[s("strong",[t._v("倒排索引")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("优点：\n"),s("ul",[s("li",[s("strong",[t._v("根据词条搜索、模糊搜索时，速度非常快")])])])]),t._v(" "),s("li",[t._v("缺点：\n"),s("ul",[s("li",[t._v("只能给词条创建索引，而不是字段")]),t._v(" "),s("li",[t._v("无法根据字段做排序")])])])]),t._v(" "),s("h2",{attrs:{id:"索引库操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#索引库操作"}},[t._v("#")]),t._v(" 索引库操作")]),t._v(" "),s("p",[t._v("索引库就类似数据库表，mapping映射就类似表的结构。")]),t._v(" "),s("p",[t._v("我们要向es中存储数据，必须先创建“库”和“表”。")]),t._v(" "),s("h3",{attrs:{id:"mapping映射属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mapping映射属性"}},[t._v("#")]),t._v(" "),s("strong",[t._v("mapping映射属性")])]),t._v(" "),s("p",[t._v("mapping是对索引库中文档的约束，常见的mapping属性包括：")]),t._v(" "),s("ul",[s("li",[t._v("type：字段数据类型，常见的简单类型有：\n"),s("ul",[s("li",[t._v("字符串：text（可分词的文本）、keyword（精确值，例如：品牌、国家、ip地址）——（不需要拆）")]),t._v(" "),s("li",[t._v("数值：long、integer、short、byte、double、float、")]),t._v(" "),s("li",[t._v("布尔：boolean")]),t._v(" "),s("li",[t._v("日期：date")]),t._v(" "),s("li",[t._v("对象：object")])])]),t._v(" "),s("li",[t._v("index：是否创建索引，"),s("strong",[t._v("默认为true")])]),t._v(" "),s("li",[t._v("analyzer：使用哪种分词器")]),t._v(" "),s("li",[t._v("properties：该字段的子字段")])]),t._v(" "),s("p",[t._v("例如下面的json文档：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"age"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"weight"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("52.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"isMarried"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"info"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"黑马程序员Java讲师"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"email"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zy@itcast.cn"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"score"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("99.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("99.5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("98.9")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"firstName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"云"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"lastName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"赵"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("对应的每个字段映射（mapping）：")]),t._v(" "),s("ul",[s("li",[t._v("age：类型为 integer；参与搜索，因此需要index为true；无需分词器")]),t._v(" "),s("li",[t._v("weight：类型为float；参与搜索，因此需要index为true；无需分词器")]),t._v(" "),s("li",[t._v("isMarried：类型为boolean；参与搜索，因此需要index为true；无需分词器")]),t._v(" "),s("li",[t._v("info：类型为字符串，需要分词，因此是text；参与搜索，因此需要index为true；分词器可以用ik_smart")]),t._v(" "),s("li",[t._v("email：类型为字符串，但是不需要分词，因此是keyword；不参与搜索，因此需要index为false；无需分词器")]),t._v(" "),s("li",[t._v("score：虽然是数组，但是我们只看元素的类型，类型为float；参与搜索，因此需要index为true；无需分词器")]),t._v(" "),s("li",[t._v("name：类型为object，需要定义多个子属性\n"),s("ul",[s("li",[t._v("name.firstName；类型为字符串，但是不需要分词，因此是keyword；参与搜索，因此需要index为true；无需分词器")]),t._v(" "),s("li",[t._v("name.lastName；类型为字符串，但是不需要分词，因此是keyword；参与搜索，因此需要index为true；无需分词器")])])])]),t._v(" "),s("h3",{attrs:{id:"索引库的crud"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#索引库的crud"}},[t._v("#")]),t._v(" 索引库的CRUD")]),t._v(" "),s("p",[t._v("这里我们统一使用Kibana编写DSL的方式来演示。")]),t._v(" "),s("h5",{attrs:{id:"创建索引库和映射"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建索引库和映射"}},[t._v("#")]),t._v(" 创建索引库和映射")]),t._v(" "),s("p",[t._v("基本语法：")]),t._v(" "),s("ul",[s("li",[t._v("请求方式：PUT")]),t._v(" "),s("li",[t._v("请求路径：/索引库名，可以自定义")]),t._v(" "),s("li",[t._v("请求参数：mapping映射")])]),t._v(" "),s("p",[t._v("格式：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("PUT /索引库名称\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"mappings"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"properties"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"字段名"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"analyzer"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ik_smart"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"字段名2"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"index"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"字段名3"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"properties"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"子字段"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword"')]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...略")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("示例：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("PUT /diana\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mappings"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"properties"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"info"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("//text类型，ik分词器，参与索引\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),t._v(",\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"analyzer"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ik_smart"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"email"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("//keyword类型，不需要分词，不参与索引\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword"')]),t._v(",\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"index"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("//object类型\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"object"')]),t._v(", \n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"properties"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"firstName"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("//keyword类型，不需要分词，参与索引\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword"')]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n          "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lastName"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword"')]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h5",{attrs:{id:"查询索引库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询索引库"}},[t._v("#")]),t._v(" 查询索引库")]),t._v(" "),s("p",[s("strong",[t._v("基本语法")]),t._v("：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("请求方式：GET")])]),t._v(" "),s("li",[s("p",[t._v("请求路径：/索引库名")])]),t._v(" "),s("li",[s("p",[t._v("请求参数：无")])])]),t._v(" "),s("p",[s("strong",[t._v("格式")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("GET /索引库名\n")])])]),s("p",[s("strong",[t._v("示例")]),t._v("：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ES/image-20210720211019329.png",alt:"image-20210720211019329"}})]),t._v(" "),s("h5",{attrs:{id:"修改索引库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改索引库"}},[t._v("#")]),t._v(" 修改索引库")]),t._v(" "),s("p",[t._v("倒排索引结构虽然不复杂，但是一旦数据结构改变（比如改变了分词器），就需要重新创建倒排索引，这简直是灾难。因此索引库"),s("strong",[t._v("一旦创建，无法修改mapping")]),t._v("。")]),t._v(" "),s("p",[t._v("虽然无法修改mapping中已有的字段，但是却允许添加新的字段到mapping中，因为不会对倒排索引产生影响。")]),t._v(" "),s("p",[s("strong",[t._v("语法说明")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("PUT /索引库名/_mapping\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"properties"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"新字段名"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"integer"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("示例")]),t._v("：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ES/image-20210720212357390.png",alt:"image-20210720212357390"}})]),t._v(" "),s("h5",{attrs:{id:"删除索引库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除索引库"}},[t._v("#")]),t._v(" 删除索引库")]),t._v(" "),s("p",[s("strong",[t._v("语法：")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("请求方式：DELETE")])]),t._v(" "),s("li",[s("p",[t._v("请求路径：/索引库名")])]),t._v(" "),s("li",[s("p",[t._v("请求参数：无")])])]),t._v(" "),s("p",[s("strong",[t._v("格式：")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("DELETE /索引库名\n")])])]),s("p",[t._v("在kibana中测试：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ES/image-20210720212123420.png",alt:"image-20210720212123420"}})]),t._v(" "),s("h5",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" "),s("strong",[t._v("总结")])]),t._v(" "),s("p",[t._v("索引库操作有哪些？")]),t._v(" "),s("ul",[s("li",[t._v("创建索引库：PUT /索引库名")]),t._v(" "),s("li",[t._v("查询索引库：GET /索引库名")]),t._v(" "),s("li",[t._v("删除索引库：DELETE /索引库名")]),t._v(" "),s("li",[t._v("添加字段：PUT /索引库名/_mapping")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("##创建索引库\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PUT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("diana\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mappings"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"properties"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"info"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"analyzer"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ik_smart"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"email"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"index"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"object"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"properties"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"firstName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword"')]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lastName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keyword"')]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n##查询索引库\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("diana\n\n##修改索引库"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("只允许添加新字段，不允许修改已经存在的字段\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PUT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("diana"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("_mapping\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"properties"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"integer"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n##删除索引库\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DELETE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("diana\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);