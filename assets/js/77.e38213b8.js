(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{414:function(s,t,a){"use strict";a.r(t);var e=a(2),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("Docker 分为 CE 和 EE 两大版本。CE 即社区版（免费，支持周期 7 个月），EE 即企业版，强调安全，付费使用，支持周期 24 个月。")]),s._v(" "),t("p",[s._v("Docker CE 分为 "),t("code",[s._v("stable")]),s._v(" "),t("code",[s._v("test")]),s._v(" 和 "),t("code",[s._v("nightly")]),s._v(" 三个更新频道。")]),s._v(" "),t("p",[s._v("官方网站上有各种环境下的 "),t("a",{attrs:{href:"https://docs.docker.com/install/",target:"_blank",rel:"noopener noreferrer"}},[s._v("安装指南"),t("OutboundLink")],1),s._v("，这里主要介绍 Docker CE 在 CentOS上的安装。")]),s._v(" "),t("h2",{attrs:{id:"centos安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#centos安装docker"}},[s._v("#")]),s._v(" CentOS安装Docker")]),s._v(" "),t("p",[s._v("Docker CE 支持 64 位版本 CentOS 7，并且要求内核版本不低于 3.10， CentOS 7 满足最低内核的要求，所以我们在CentOS 7安装Docker。")]),s._v(" "),t("h3",{attrs:{id:"卸载-可选"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#卸载-可选"}},[s._v("#")]),s._v(" 卸载（可选）")]),s._v(" "),t("p",[s._v("如果之前安装过旧版本的Docker，可以使用下面命令卸载：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("yum remove docker \\\n                  docker-client \\\n                  docker-client-latest \\\n                  docker-common \\\n                  docker-latest \\\n                  docker-latest-logrotate \\\n                  docker-logrotate \\\n                  docker-selinux \\\n                  docker-engine-selinux \\\n                  docker-engine \\\n                  docker-ce\n")])])]),t("h3",{attrs:{id:"安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装docker")]),s._v(" "),t("p",[s._v("首先需要大家虚拟机联网，安装yum工具")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" yum-utils "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n           device-mapper-persistent-data "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n           lvm2 --skip-broken\n")])])]),t("p",[s._v("然后更新本地镜像源：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置docker镜像源")]),s._v("\nyum-config-manager "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --add-repo "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n    \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/download.docker.com/mirrors.aliyun.com\\/docker-ce/g'")]),s._v(" /etc/yum.repos.d/docker-ce.repo\n\nyum makecache fast\n")])])]),t("p",[s._v("然后输入命令：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" docker-ce\n")])])]),t("p",[s._v("docker-ce为社区免费版本。稍等片刻，docker即可安装成功。")]),s._v(" "),t("h3",{attrs:{id:"启动docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动docker"}},[s._v("#")]),s._v(" 启动docker")]),s._v(" "),t("p",[s._v("Docker应用需要用到各种端口，逐一去修改防火墙设置。非常麻烦，因此建议大家直接关闭防火墙！")]),s._v(" "),t("p",[s._v("启动docker前，一定要关闭防火墙后！！")]),s._v(" "),t("p",[s._v("启动docker前，一定要关闭防火墙后！！")]),s._v(" "),t("p",[s._v("启动docker前，一定要关闭防火墙后！！")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭")]),s._v("\nsystemctl stop firewalld\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止开机启动防火墙")]),s._v("\nsystemctl disable firewalld\n")])])]),t("p",[s._v("通过命令启动docker：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("systemctl start "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动docker服务")]),s._v("\n\nsystemctl status "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看docker状态")]),s._v("\n\nsystemctl stop "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止docker服务")]),s._v("\n\nsystemctl restart "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启docker服务")]),s._v("\n")])])]),t("p",[s._v("然后输入命令，可以查看docker版本：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("docker -v\n")])])]),t("p",[s._v("如图：")]),s._v(" "),t("p",[t("img",{attrs:{src:"assets/image-20210418154704436.png",alt:"image-20210418154704436"}})]),s._v(" "),t("h3",{attrs:{id:"配置镜像加速"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置镜像加速"}},[s._v("#")]),s._v(" 配置镜像加速")]),s._v(" "),t("p",[s._v("docker官方镜像仓库网速较差，我们需要设置国内镜像服务：")]),s._v(" "),t("p",[s._v("参考阿里云的镜像加速文档：https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/docker\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/docker/daemon.json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'EOF\'\n{\n  "registry-mirrors": ["https://q58amku2.mirror.aliyuncs.com"]\n}\nEOF')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])])]),t("h2",{attrs:{id:"centos7安装dockercompose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#centos7安装dockercompose"}},[s._v("#")]),s._v(" CentOS7安装DockerCompose")]),s._v(" "),t("h3",{attrs:{id:"下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载"}},[s._v("#")]),s._v(" 下载")]),s._v(" "),t("p",[s._v("Linux下需要通过命令下载：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" https://github.com/docker/compose/releases/download/1.23.1/docker-compose-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /usr/local/bin/docker-compose\n")])])]),t("p",[s._v("如果下载速度较慢，或者下载失败，可以使用课前资料提供的docker-compose文件：")]),s._v(" "),t("p",[t("img",{attrs:{src:"assets/image-20210417133020614.png",alt:"image-20210417133020614"}})]),s._v(" "),t("p",[s._v("上传到"),t("code",[s._v("/usr/local/bin/")]),s._v("目录也可以。")]),s._v(" "),t("h3",{attrs:{id:"修改文件权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改文件权限"}},[s._v("#")]),s._v(" 修改文件权限")]),s._v(" "),t("p",[s._v("修改文件权限：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/docker-compose\n")])])]),t("h3",{attrs:{id:"base自动补全命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#base自动补全命令"}},[s._v("#")]),s._v(" Base自动补全命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 补全命令---还是得翻墙才好用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/bash_completion.d/docker-compose\n\n\n")])])]),t("p",[s._v("如果这里出现错误，需要修改自己的hosts文件：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"199.232.68.133 raw.githubusercontent.com"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这里不需要，翻墙就可以了")]),s._v("\n")])])]),t("h2",{attrs:{id:"docker镜像仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker镜像仓库"}},[s._v("#")]),s._v(" Docker镜像仓库")]),s._v(" "),t("p",[s._v("搭建镜像仓库可以基于Docker官方提供的DockerRegistry来实现。")]),s._v(" "),t("p",[s._v("官网地址：https://hub.docker.com/_/registry")]),s._v(" "),t("h3",{attrs:{id:"简化版镜像仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简化版镜像仓库"}},[s._v("#")]),s._v(" 简化版镜像仓库")]),s._v(" "),t("p",[s._v("Docker官方的Docker Registry是一个基础版本的Docker镜像仓库，具备仓库管理的完整功能，但是没有图形化界面。")]),s._v(" "),t("p",[s._v("搭建方式比较简单，命令如下：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" registry\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" registry-data:/var/lib/registry "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    registry\n")])])]),t("p",[s._v("命令中挂载了一个数据卷registry-data到容器内的/var/lib/registry 目录，这是私有镜像库存放数据的目录。")]),s._v(" "),t("p",[s._v("访问http://YourIp:5000/v2/_catalog 可以查看当前私有镜像服务中包含的镜像")]),s._v(" "),t("h3",{attrs:{id:"带有图形化界面版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#带有图形化界面版本"}},[s._v("#")]),s._v(" 带有图形化界面版本")]),s._v(" "),t("p",[s._v("使用DockerCompose部署带有图象界面的DockerRegistry，命令如下：")]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.0'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("registry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" registry\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/lib/registry\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ui")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" joxit/docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("static\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8080"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" REGISTRY_TITLE=传智教育私有仓库\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" REGISTRY_URL=http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" registry\n")])])]),t("h3",{attrs:{id:"配置docker信任地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置docker信任地址"}},[s._v("#")]),s._v(" 配置Docker信任地址")]),s._v(" "),t("p",[s._v("我们的私服采用的是http协议，默认不被Docker信任，所以需要做一个配置：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开要修改的文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/docker/daemon.json\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加内容：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.159.100:8080"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重加载")]),s._v("\nsystemctl daemon-reload\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启docker")]),s._v("\nsystemctl restart "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);