(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{442:function(s,t,a){"use strict";a.r(t);var v=a(2),_=Object(v.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"本地事务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本地事务"}},[s._v("#")]),s._v(" 本地事务")]),s._v(" "),t("p",[s._v("本地事务，也就是传统的"),t("strong",[s._v("单机事务")]),s._v("。在传统数据库事务中，必须要满足四个原则：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E8%BF%9B%E9%98%B6/image-20210724165045186.png",alt:"image-20210724165045186"}})]),s._v(" "),t("h2",{attrs:{id:"分布式事务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分布式事务"}},[s._v("#")]),s._v(" 分布式事务")]),s._v(" "),t("p",[t("strong",[s._v("分布式事务")]),s._v("，就是指不是在单个服务或单个数据库架构下，产生的事务，例如：")]),s._v(" "),t("ul",[t("li",[s._v("跨数据源的分布式事务")]),s._v(" "),t("li",[s._v("跨服务的分布式事务")]),s._v(" "),t("li",[s._v("综合情况")])]),s._v(" "),t("p",[s._v("在数据库水平拆分、服务垂直拆分之后，一个业务操作通常要跨多个数据库、服务才能完成。例如电商行业中比较常见的下单付款案例，包括下面几个行为：")]),s._v(" "),t("ul",[t("li",[s._v("创建新订单")]),s._v(" "),t("li",[s._v("扣减商品库存")]),s._v(" "),t("li",[s._v("从用户账户余额扣除金额")])]),s._v(" "),t("p",[s._v("完成上面的操作需要访问三个不同的微服务和三个不同的数据库。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E8%BF%9B%E9%98%B6/image-20210724165338958.png",alt:"image-20210724165338958"}})]),s._v(" "),t("p",[s._v("订单的创建、库存的扣减、账户扣款在每一个服务和数据库内是一个本地事务，可以保证ACID原则。")]),s._v(" "),t("p",[s._v('但是当我们把三件事情看做一个"业务"，要满足保证“业务”的原子性，要么所有操作全部成功，要么全部失败，不允许出现部分成功部分失败的现象，这就是'),t("strong",[s._v("分布式系统下的事务")]),s._v("了。")]),s._v(" "),t("p",[s._v("此时ACID难以满足，这是分布式事务要解决的问题")]),s._v(" "),t("h2",{attrs:{id:"演示分布式事务问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#演示分布式事务问题"}},[s._v("#")]),s._v(" 演示分布式事务问题")]),s._v(" "),t("p",[s._v("我们通过一个案例来演示分布式事务的问题：")]),s._v(" "),t("p",[s._v("1）"),t("strong",[s._v("创建数据库，名为seata_demo，然后导入课前资料提供的SQL文件：")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E8%BF%9B%E9%98%B6/image-20210724165634571.png",alt:"image-20210724165634571"}})]),s._v(" "),t("p",[s._v("2）"),t("strong",[s._v("导入课前资料提供的微服务：")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E8%BF%9B%E9%98%B6/image-20210724165709994.png",alt:"image-20210724165709994"}})]),s._v(" "),t("p",[s._v("微服务结构如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E8%BF%9B%E9%98%B6/image-20210724165729273.png",alt:"image-20210724165729273"}})]),s._v(" "),t("p",[s._v("其中：")]),s._v(" "),t("p",[s._v("seata-demo：父工程，负责管理项目依赖")]),s._v(" "),t("ul",[t("li",[s._v("account-service：账户服务，负责管理用户的资金账户。提供扣减余额的接口")]),s._v(" "),t("li",[s._v("storage-service：库存服务，负责管理商品库存。提供扣减库存的接口")]),s._v(" "),t("li",[s._v("order-service：订单服务，负责管理订单。创建订单时，需要调用account-service和storage-service")])]),s._v(" "),t("p",[t("strong",[s._v("3）启动nacos、所有微服务")])]),s._v(" "),t("p",[t("strong",[s._v("4）测试下单功能，发出Post请求：")])]),s._v(" "),t("p",[s._v("请求如下：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--request")]),s._v(" POST "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost:8082/order?userId=user202103032042012&commodityCode=100202003032041&count=20&money=200'")]),s._v("\n")])])]),t("p",[s._v("如图：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E8%BF%9B%E9%98%B6/image-20210724170113404.png",alt:"image-20210724170113404"}})]),s._v(" "),t("p",[s._v("测试发现，当库存不足时，如果余额已经扣减，并不会回滚，出现了分布式事务问题。")])])}),[],!1,null,null,null);t.default=_.exports}}]);